<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" type="text/css" href="../../Resources/common-style.css">
    <link rel="stylesheet" type="text/css" href="../../Resources/page-style.css">
    <link rel="stylesheet" type="text/css" href="../../Resources/syntax-highlight-style.css">
    <script src="../../Resources/common.js"></script>
    <script src="../../Resources/page.js"></script>
    <script src="../../Resources/prism.js"></script>
    <script src="../../Resources/prism-normalize-whitespace.js"></script>
    <script src="../../Resources/prism-c.js"></script>
    <script src="../../Resources/prism-cpp.js"></script>
    <script src="../../Resources/prism-csharp.js"></script>
    <script src="../../Resources/prism-python.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            onContentLoaded('../../shell.html');
        });
    </script>
</head>
<body>

<h1><a class="header-path" href="UserGuide.html">User guide: </a> <a class="header-path" href="#">Computer vision</a></h1>

<p>This chapter shows how to <strong>utilize computer vision capabilities</strong> of <strong>AutoScript Toolkit</strong> add-on.</p>

<p>
Before proceeding with the code snippets listed below, initialize AutoScript with the following code.
Do not forget to set the server address or host name (parameters of the <code class="language-python">connect()</code> function) according to your environment.
</p>

    <pre><code class="language-python">
    from autoscript_sdb_microscope_client import SdbMicroscopeClient
    from autoscript_sdb_microscope_client.enumerations import *
    from autoscript_sdb_microscope_client.structures import *

    microscope = SdbMicroscopeClient()
    microscope.connect("localhost")
    </code></pre>
    <p style="height:1px"/>


<p><strong>Import computer vision toolkit</strong> with a convenient alias:</p>

    <pre><code class="language-python">
    import autoscript_toolkit.vision as vision_toolkit
    </code></pre>
    <p style="height:1px"/>


<p><strong>Prepare function to plot images:</strong></p>

    <pre><code class="language-python">
    from matplotlib import pyplot as plot

    def quick_plot(image):
        plot.imshow(image.data, cmap='gray')
        plot.show()
    </code></pre>
    <p style="height:1px"/>


<p><strong>Cut out image region </strong>using <em>relative coordinates</em>.</p>

    <pre><code class="language-python">
    settings = GrabFrameSettings(resolution="1536x1024", dwell_time=1e-6)
    image = microscope.imaging.grab_frame(settings)

    region = vision_toolkit.cut_image(image, relative_center=[0.40, 0.40], relative_size=[0.20, 0.20])
    quick_plot(image)
    quick_plot(region )
    </code></pre>
    <p style="height:1px"/>


<p><strong>Cut out image region</strong> using <em>pixel coordinates</em>:</p>

    <pre><code class="language-python">
    settings = GrabFrameSettings(resolution="1536x1024", dwell_time=1e-6)
    image = microscope.imaging.grab_frame(settings)

    region1 = vision_toolkit.cut_image(image, center=[140, 96], size=[120, 120])
    region2 = vision_toolkit.cut_image(image, top_left=[80, 36], bottom_right=[200, 156])
    quick_plot(image)
    quick_plot(region1)
    quick_plot(region2)
    </code></pre>
    <p style="height:1px"/>


<p><strong>Locate feature in the image</strong> using <em>default template matcher</em> and inspect the result:</p>

    <pre><code class="language-python">
    # Take full frame image and cut out a template from it
    settings = GrabFrameSettings(resolution="1536x1024", dwell_time=1e-6)
    image = microscope.imaging.grab_frame(settings)
    template = vision_toolkit.cut_image(image, relative_center=[0.40, 0.40], relative_size=[0.20, 0.20])

    # Locate feature from the template in the original image
    location = vision_toolkit.locate_feature(image, template)
    location.print_all_information()
    vision_toolkit.plot_match(image, template, location.center_in_pixels)
    </code></pre>
    <p style="height:1px"/>


<p><strong>Locate feature in the image</strong> using <em>specialized HOG (histogram of gradients) template matcher</em> and inspect the result:</p>

    <pre><code class="language-python">
    from autoscript_toolkit.template_matchers import *
    
    # Take full frame image
    settings = GrabFrameSettings(resolution="1536x1024", dwell_time=1e-6)
    image = microscope.imaging.grab_frame(settings )
    
    # Take reduced area image
    settings = GrabFrameSettings(reduced_area=Rectangle(0.05, 0.05, 0.10, 0.10))
    template = microscope.imaging.grab_frame(settings)
    
    # Locate feature from the template in the original image
    hog_matcher = HogMatcher(microscope)
    location = vision_toolkit.locate_feature(image, template, hog_matcher)
    location.print_all_information()
    vision_toolkit.plot_match(image, template, location.center_in_pixels)
    </code></pre>
    <p style="height:1px"/>

</body>
</html>
